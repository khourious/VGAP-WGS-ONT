#!/bin/bash

# author: Laise de Moraes <laisepaixao@live.com>
# institution: Oswaldo Cruz Foundation, GonÃ§alo Moniz Institute, Bahia, Brazil
# URL: https://lpmor22.github.io
# date: 30 MAY 2021

mkdir LIBRARIES RAW -v

if [[ -z "$(which guppy_basecaller)" ]]; then
    guppy_version=5.0.7
    cd
    curl https://mirror.oxfordnanoportal.com/software/analysis/ont-guppy_"$guppy_version"_linux64.tar.gz -o ont-guppy.tar.gz
    tar -vzxf ont-guppy.tar.gz
    rm -rf ont-guppy.tar.gz
    echo 'export PATH=$HOME/ont-guppy/bin:/usr/local/share/rsi/idl/bin:$PATH' >> $HOME/.*hrc
    export PATH=$HOME/ont-guppy/bin:/usr/local/share/rsi/idl/bin:$PATH
else
    guppy_basecaller --version
fi

if [[ -z "$(which conda)" ]]; then
    cd
    wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh
    bash Miniconda3-latest-Linux-x86_64.sh -bfp miniconda3
    rm Miniconda3-latest-Linux-x86_64.sh
    echo 'export PATH=$HOME/miniconda3/bin:/usr/local/share/rsi/idl/bin:$PATH' >> $HOME/.*hrc
    export PATH=$HOME/miniconda3/bin:/usr/local/share/rsi/idl/bin:$PATH
    if [[ -z "$(which mamba)" ]]; then
        conda install -y -c conda-forge mamba
    else
        mamba update -y -n base conda
        mamba create -y -n illumina -c conda-forge -c bioconda -c defaults bcftools bwa exonerate fastqc ivar mafft samtools
        mamba create -y -n minion -c conda-forge -c bioconda -c defaults artic exonerate
        mamba create -y -n minion-qc -c conda-forge -c bioconda -c defaults python=3.6 pycoqc
    fi
else
    if [[ -z "$(which mamba)" ]]; then
        conda install -y -c conda-forge mamba
    else
        mamba update -y -n base conda
        mamba create -y -n illumina -c conda-forge -c bioconda -c defaults bcftools bwa exonerate fastqc ivar mafft samtools
        mamba create -y -n minion -c conda-forge -c bioconda -c defaults artic exonerate
        mamba create -y -n minion-qc -c conda-forge -c bioconda -c defaults python=3.6 pycoqc
    fi
fi

[ ! -d $HOME/bin ] && mkdir -p $HOME/bin -v
ln -s $HOME/VirWGS/SCRIPTS/* $HOME/bin
